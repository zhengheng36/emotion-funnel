<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emotion Funnel / 情绪精准定位漏斗</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
    <!-- 导航区域 -->
    <div class="nav-header">
        <button id="back-btn" class="back-btn hidden" onclick="app.back()">
            <span data-i18n="btn_back">⬅ 返回</span>
        </button>
        
        <div class="nav-actions">
            <!-- 语言切换按钮 -->
            <button class="action-btn" onclick="app.toggleLang()">
                <span id="lang-display">EN / 中</span>
            </button>
            
            <!-- 【新增】夜间模式切换按钮 -->
            <button class="action-btn" onclick="app.toggleTheme()" title="Switch Theme">
                <span id="theme-icon">🌙</span>
            </button>
        </div>
    </div>

    <div class="progress-bar">
        <div class="progress-fill" id="progress"></div>
    </div>

    <!-- Step 1: Q1 -->
    <div id="view-q1" class="view-section active">
        <h1 data-i18n="step1_title">第一步：大方向判断</h1>
        <h2 data-i18n="q1_text">问题 1：你现在的感觉大体上是舒服的，还是难受的？</h2>
        <div class="btn-group">
            <button class="choice-btn" onclick="app.navigate('view-group', 'G')">
                <span data-i18n="q1_opt1">🟢 舒服 / 积极</span> <span>➜</span>
            </button>
            <button class="choice-btn" onclick="app.navigate('view-q2')">
                <span data-i18n="q1_opt2">🔴 难受 / 消极</span> <span>➜</span>
            </button>
            <button class="choice-btn" onclick="app.navigate('view-group', 'D')">
                <span data-i18n="q1_opt3">⚪ 惊讶 / 意外</span> <span>➜</span>
            </button>
        </div>
        <div style="margin-top: 30px; border-top: 1px solid var(--border-color); padding-top: 20px;">
            <button class="image-link-btn" onclick="app.navigate('view-image')">
                <span data-i18n="btn_image">🔍 查看完整情绪识别轮盘</span>
            </button>
        </div>
    </div>

    <!-- Step 1: Q2 -->
    <div id="view-q2" class="view-section">
        <h1 data-i18n="step1_title">第一步：大方向判断</h1>
        <h2 data-i18n="q2_text">问题 2：你的身体能量状态如何？</h2>
        <div class="btn-group">
            <button class="choice-btn" onclick="app.navigate('view-q3')">
                <span data-i18n="q2_opt1">🔥 能量高 (心跳快、想动、肌肉紧绷)</span> <span>➜</span>
            </button>
            <button class="choice-btn" onclick="app.navigate('view-q4')">
                <span data-i18n="q2_opt2">💧 能量低 (身体沉重、不想动、无力)</span> <span>➜</span>
            </button>
            <button class="choice-btn" onclick="app.navigate('view-group', 'F')">
                <span data-i18n="q2_opt3">🤢 排斥感 (想吐、皱眉、想推开)</span> <span>➜</span>
            </button>
        </div>
    </div>

    <!-- Step 1: Q3 -->
    <div id="view-q3" class="view-section">
        <h1 data-i18n="step1_title">第一步：大方向判断</h1>
        <h2 data-i18n="q3_text">问题 3：这种高能量的方向是？</h2>
        <div class="btn-group">
            <button class="choice-btn" onclick="app.navigate('view-group', 'A')">
                <span data-i18n="q3_opt1">⚔️ 对外 / 攻击 (想反击、想破坏)</span> <span>➜</span>
            </button>
            <button class="choice-btn" onclick="app.navigate('view-group', 'B')">
                <span data-i18n="q3_opt2">🛡️ 对内 / 躲避 (想逃跑、想钻地洞)</span> <span>➜</span>
            </button>
        </div>
    </div>

    <!-- Step 1: Q4 -->
    <div id="view-q4" class="view-section">
        <h1 data-i18n="step1_title">第一步：大方向判断</h1>
        <h2 data-i18n="q4_text">问题 4：这种无力感的主要来源是？</h2>
        <div class="btn-group">
            <button class="choice-btn" onclick="app.navigate('view-group', 'C')">
                <span data-i18n="q4_opt1">💔 情感上的痛 (失去感、想哭)</span> <span>➜</span>
            </button>
            <button class="choice-btn" onclick="app.navigate('view-group', 'E')">
                <span data-i18n="q4_opt2">🔋 生理/心理的累 (过载、死机)</span> <span>➜</span>
            </button>
        </div>
    </div>

    <!-- Step 2: 精准定位 -->
    <div id="view-group" class="view-section">
        <h1 data-i18n="step2_title">第二步：精准定位</h1>
        <h2 id="group-title"></h2>
        <p class="subtitle" data-i18n="step2_subtitle">请选择最符合你当下情况的描述：</p>
        <div id="group-questions" class="btn-group"></div>
    </div>

    <!-- Step 3: 最终选择 -->
    <div id="view-final" class="view-section">
        <h1 data-i18n="step3_title">第三步：确认细微差别</h1>
        <h2 id="sub-title"></h2>
        <div id="final-choices" class="btn-group"></div>
    </div>

    <!-- Result -->
    <div id="view-result" class="view-section">
        <div class="result-header">
            <div data-i18n="result_intro">你当前的情绪定位是：</div>
            <div class="final-emotion" id="result-word"></div>
            <div class="result-sub-text"><span data-i18n="result_group_prefix"></span> <span id="result-core"></span> <span data-i18n="result_group_suffix"></span></div>
        </div>

        <button class="image-link-btn" style="margin-bottom: 20px;" onclick="app.navigate('view-image')">
            <span data-i18n="btn_image_compare">🔍 对照完整情绪轮盘</span>
        </button>

        <div class="content-card">
            <h3 data-i18n="result_analysis_title">📖 情绪解析与解药</h3>
            <p data-i18n="result_analysis_intro">这是你的情绪机制拆解。**高亮行**是你当前的状态。</p>
            <div id="content-display"></div>
        </div>

        <!-- 【修改】这里绑定的是 app.restart() 而不是 location.reload() -->
        <button class="restart-btn" onclick="app.restart()">
            <span data-i18n="btn_restart">🔄 重新测试</span>
        </button>
    </div>

    <!-- Image View -->
    <div id="view-image" class="view-section">
        <h1 data-i18n="img_title">情绪识别轮盘</h1>
        <div class="full-image-container">
            <img src="image.jpg" alt="情绪识别轮盘" onclick="app.toggleZoom(true)" style="cursor: zoom-in;" title="Zoom">
        </div>
        
        <button class="choice-btn" style="justify-content: center; margin-top: 20px;" onclick="app.back()">
            <span data-i18n="btn_back_prev">⬅ 返回刚才的位置</span>
        </button>
    </div>
</div>

<script src="data.js"></script>
<script src="logic.js"></script>
</body>
</html>